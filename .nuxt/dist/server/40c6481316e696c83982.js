exports.ids=[4],exports.modules={84:function(e,t,r){"use strict";var l=r(5),o=r.n(l),n={async post(e,data){console.log("axios node_env:","production");let t="http://mall.admin.jianpiane.com";console.log("axios domain:",t),e=t+e,console.log("axios url: ",e);let r=await o.a.post(e,data);return console.log("axios status: ",r.status),r.data}};t.a={getUserIdByMobile:async data=>await n.post("/api/user/data/getUserIdByMobile",{mobile:data.mobile}),getListByUserIds:async data=>await n.post("/api/user/data/getListByUserIds",{user_ids:data.user_ids}),getOrderList:async data=>await n.post("/api/mall/order/list",data),cancelOrder:async data=>await n.post("/api/mall/order/cancel",data),updateOrder:async data=>await n.post("/api/mall/order/update",data),paymentCreate:async data=>await n.post("/api/mall/payment/create",data),paymentComplete:async data=>await n.post("/api/mall/payment/complete",data),getPaymentList:async data=>await n.post("/api/mall/payment/list",data),getGoodsList:async data=>(data.business_id=0,await n.post("/api/mall/goods/list",data)),goodsDataCreate:async data=>(data.business_id=0,await n.post("/api/mall/goods/create",data)),goodsDataUpdate:async data=>(data.business_id=0,await n.post("/api/mall/goods/update",data)),categoryDataUpdate:async data=>(data.business_id=0,await n.post("/api/mall/goods/categoryUpdate",data)),getGoodsCategoryList:async data=>(data.business_id=0,await n.post("/api/mall/goods/categorys",data)),statisticsTodayData:async(data={})=>await n.post("/api/mall/statistics/today",data)}},85:function(e,t,r){"use strict";var l=r(83),o=r.n(l);t.a={formValidata:e=>new Promise((t,r)=>{e.validate(e=>{t(!!e)})}),unLimitTreeLevel(e,t=0){var r=[],l=function(e,t,o){for(var i=0;i<e.length;i++){var n=e[i];if(n.pid==t){n.level=o,n.html="";for(let e=0;e<o;e++)n.html+=" -- ";r.push(n),l(e,n.id,o+1)}}};return l(e,t,0),r},getTimestamp(e){let t=new Date(e);return parseInt(t.getTime()/1e3)},dateFormat(e,t){t=t||"YYYY-MM-DD HH:mm";let r=null;return r=e?new Date(1e3*e):new Date,o()(r).format(t)},dateDisplay(e){let t=parseInt(Date.now()/1e3)-e;if(t<60)return t+"秒前";if(t>=60&&t<3600)return parseInt(t/60).toString()+"分钟前";if(t>=3600&&t<86400)return parseInt(t/3600).toString()+"小时前";if(t>=86400&&t<2592e3)return parseInt(t/3600/24).toString()+"天前";{let t="YYYY-MM-DD HH:mm",r=new Date(1e3*e);return o()(r).format(t)}},monthPlus(e,t=1,r=!0){let l=[31,28,31,30,31,30,31,31,30,31,30,31],o=parseInt(this.dateFormat(e,"YYYY")),n=parseInt(this.dateFormat(e,"MM")),d=parseInt(this.dateFormat(e,"DD"));l[1]=o%4==0&&o/100!=0||o%100==0&&o%400==0?29:28;let c=0;c+=l[n-1]-d;for(let i=0;i<t;i++){(n+=1)>12&&(n=1,o+=1),l[1]=o%4==0&&o/100!=0||o%100==0&&o%400==0?29:28;let e=l[n-1];i==t-1&&(e=e-d<0?e:d),console.log("for days:",e),c+=e}return r?(e=e||parseInt(Date.now()/1e3))+24*c*3600:c}}},87:function(e,t,r){"use strict";r.r(t);var l=r(85),o=r(84),n={head:()=>({title:"订单管理"}),data:()=>({list:[],page:1,limit:10,count:0,statusVal:"",search:"",searchUserId:"",userList:[],statusOptions:[{id:"",name:"所有"},{id:0,name:"未付款"},{id:1,name:"待发货"},{id:2,name:"待收货"},{id:3,name:"已完成"},{id:-1,name:"已取消"}],dialogExpressUpdateVisible:!1,orderExpressInfoUpdateBtn:{disabled:!1},expressOrder:{},expressData:{},rulesExpressData:{company:[{required:!0,message:"请输入物流公司名称",trigger:"blur"}],no:[{required:!0,message:"请输入物流单号",trigger:"blur"}]}}),methods:{...l.a,async getList(){let data={};data.page=this.page,data.limit=this.limit,""!==this.statusVal&&(data.status=this.statusVal),this.search&&(this.search.length>20?data.order_no=this.search:11==this.search.length?data.user_id=this.searchUserId:this.search.length<11&&(data.order_id=this.search));let e=await o.a.getOrderList(data);console.log("/getList ret",e),this.list=e.data.rows,this.count=e.data.count},async getSearchList(){this.search;if(11==this.search.length){let e=await o.a.getUserIdByMobile({mobile:this.search});console.log("/getSearchList searchRet:",e),0===e.code&&e.data&&e.data.id?this.searchUserId=e.data.uuid:this.searchUserId=""}else this.searchUserId="";this.page=1,this.getList()},pageChange(e){console.log("/pageChange:",e),this.page=e,this.getList()},statusChange(){console.log("/statusChange:",this.statusVal),this.page=1,this.getList()},orderCancel(e){let t={};t.id=e.id,t.user_id=e.user_id,t.cancel_reason="后台取消",this.$confirm("是否将该订单设置为取消状态, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{let r=await o.a.cancelOrder(t);console.log("/orderCancel cancelRet:",r),0==r.code?(e.status=-1,this.$message({type:"success",message:"取消成功!"})):this.$message({type:"info",message:t.message})}).catch(()=>{})},orderComplete(e){this.$confirm("是否确认该订单已支付, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{let t=await this.orderCompleteSubmit(e);console.log("/orderComplete orderCompleteRet:",t),0==t.code?(e.status=1,this.$message({type:"success",message:"确认成功!"})):this.$message({type:"info",message:t.message})}).catch(()=>{})},async orderCompleteSubmit(e){let t={user_id:e.user_id,order_ids:[e.id],total:e.total,amount:e.total,score:0,pay_type:0,pay_method:0,balance:0,coupon:0,user_coupon_id:0,remark:"后台生成"},r=await o.a.paymentCreate(t);if(console.log("/orderCompleteSubmit paymentCreateRet:",r),r.code)return r;let l=r.data.out_trade_no,n={user_id:e.user_id,out_trade_no:l,remark:"后台确认"},d=await o.a.paymentComplete(n);return console.log("/orderCompleteSubmit paymentCompleteRet:",d),r},orderExpressBtnClick(e){this.expressOrder=e;let t=e.express_info?JSON.parse(e.express_info):{};this.expressData=Object.assign({},t),this.dialogExpressUpdateVisible=!0},async orderExpressInfoUpdate(){this.orderExpressInfoUpdateBtn.disabled=!0;let data={order_id:this.expressOrder.id,user_id:this.expressOrder.user_id,express_info:JSON.stringify(this.expressData)};try{let e=await o.a.updateOrder(data);if(0!=e.code)throw new Error(e.message);this.$message("更新物流信息成功"),this.getList()}catch(e){this.$message.error(e.message||e)}this.dialogExpressUpdateVisible=!1,this.orderExpressInfoUpdateBtn.disabled=!1},showAddress(e){let t=e?JSON.parse(e):{};if(!t||!t.id||t.id<=0)return"-";let r="";return r+=`<p>${t.name} / ${t.tel} / ${t.postalCode}</p>`,r+=`<p class="text-gray-500 text-xl">${t.province}/${t.city}/${t.county} / ${t.address}</p>`},async getUserList(){let e=[];this.user_id=[],this.list.forEach(t=>{e.push(t.user_id)});let t=await o.a.getListByUserIds({user_ids:e});console.log("/getUserList ret:",t),0===t.code&&(this.userList=t.data)}},created(){this.getList().then(()=>{this.getUserList()})}},d=r(2),component=Object(d.a)(n,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"mt-4"},[r("el-row",[r("el-col",{attrs:{span:12}},[r("el-input",{attrs:{placeholder:"请输入订单号或者用户手机号码"},on:{change:e.getSearchList},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}},[r("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})])],1),e._v(" "),r("el-col",{staticClass:"text-right",attrs:{span:12}},[r("el-select",{attrs:{placeholder:"请选择"},on:{change:e.statusChange},model:{value:e.statusVal,callback:function(t){e.statusVal=t},expression:"statusVal"}},e._l(e.statusOptions,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),e._ssrNode(" "),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.list}},[r("el-table-column",{attrs:{label:"订单号",prop:"order_no"}}),e._v(" "),r("el-table-column",{attrs:{label:"用户信息"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(e.userList,(function(l){return l.uuid==t.row.user_id?r("span",{staticClass:"text-blue-500"},[e._v(e._s(l.username)+" / "+e._s(l.mobile))]):e._e()}))}}])}),e._v(" "),r("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.dateFormat(t.row.create_time)))]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"订单金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{staticClass:"text-red-600"},[e._v("￥"+e._s((t.row.total/100).toFixed(2)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"数量",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.items.length))]}}])}),e._v(" "),r("el-table-column",{attrs:{type:"expand",label:"商品"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-table",{staticStyle:{width:"100%"},attrs:{data:t.row.items}},[r("el-table-column",{attrs:{label:"商品图片"},scopedSlots:e._u([{key:"default",fn:function(e){return[r("img",{attrs:{src:e.row.cover,width:"30",height:"30"}})]}}],null,!0)}),e._v(" "),r("el-table-column",{attrs:{label:"商品名称",prop:"name"}}),e._v(" "),r("el-table-column",{attrs:{label:"成本"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{},[e._v("￥"+e._s((t.row.price_cost/100).toFixed(2)))])]}}],null,!0)}),e._v(" "),r("el-table-column",{attrs:{label:"单价"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{staticClass:"text-red-600"},[e._v("￥"+e._s((t.row.price/100).toFixed(2)))])]}}],null,!0)}),e._v(" "),r("el-table-column",{attrs:{label:"购买数量",prop:"num"}}),e._v(" "),r("el-table-column",{attrs:{label:"价格"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{staticClass:"text-red-600"},[e._v("￥"+e._s((t.row.total/100).toFixed(2)))])]}}],null,!0)})],1)]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"地址"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{domProps:{innerHTML:e._s(e.showAddress(t.row.address))}})]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.status?r("span",{staticClass:"text-red-600"},[e._v("未付款")]):e._e(),e._v(" "),1==t.row.status?r("span",{staticClass:"text-orange-600"},[e._v("待发货")]):e._e(),e._v(" "),2==t.row.status?r("span",{staticClass:"text-blue-600"},[e._v("待收货")]):e._e(),e._v(" "),3==t.row.status?r("span",[e._v("已完成")]):e._e(),e._v(" "),-1==t.row.status?r("span",[e._v("已取消")]):e._e()]}}])}),e._v(" "),r("el-table-column",{attrs:{fixed:"right",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.status?r("el-button",{attrs:{type:"warning",plain:"",size:"small"},on:{click:function(r){return e.orderCancel(t.row)}}},[e._v("取消订单")]):e._e(),e._v(" "),0==t.row.status?r("el-button",{staticClass:"text-red-600",attrs:{type:"danger",plain:"",size:"small"},on:{click:function(r){return e.orderComplete(t.row)}}},[e._v("确认付款")]):e._e(),e._v(" "),1==t.row.status?r("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:function(r){return e.orderExpressBtnClick(t.row)}}},[e._v("发货信息填写")]):e._e(),e._v(" "),2==t.row.status?r("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:function(r){return e.orderExpressBtnClick(t.row)}}},[e._v("发货信息修改")]):e._e()]}}])})],1),e._ssrNode(" "),r("el-pagination",{staticClass:"mt-4",attrs:{"current-page":e.page,"page-size":e.limit,layout:"prev, pager, next, total, jumper",total:e.count},on:{"current-change":e.pageChange,"prev-click":e.pageChange,"next-click":e.pageChange}}),e._ssrNode(" "),r("el-dialog",{attrs:{title:"商品发货",visible:e.dialogExpressUpdateVisible},on:{"update:visible":function(t){e.dialogExpressUpdateVisible=t}}},[r("el-form",{ref:"formExpressUpdate",attrs:{model:e.expressData,"label-width":"100px",rules:e.rulesExpressData}},[r("el-form-item",{attrs:{label:"物流公司",prop:"company"}},[r("el-input",{model:{value:e.expressData.company,callback:function(t){e.$set(e.expressData,"company",t)},expression:"expressData.company"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"物流单号",prop:"no"}},[r("el-input",{model:{value:e.expressData.no,callback:function(t){e.$set(e.expressData,"no",t)},expression:"expressData.no"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogExpressUpdateVisible=!1}}},[e._v("取消")]),e._v(" "),r("el-button",{attrs:{type:"primary",disabled:e.orderExpressInfoUpdateBtn.disabled},on:{click:e.orderExpressInfoUpdate}},[e._v("确定")])],1)],1)],2)}),[],!1,null,null,"00ffedc6");t.default=component.exports}};